<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="cn.fintecher.pangolin.report.mapper.QueryFollowupMapper">

    <!--获取部门下所有用户-->
    <select id="getExportFollowModel" parameterType="java.util.List"  resultType="cn.fintecher.pangolin.report.model.ExportFollowupParams">
SELECT a.case_number AS casenum,b.batch_number AS batchNum,e.`name` AS principalName,a.operator_time AS followTime,a.type AS followType,c.`name` AS personName,c.id_card AS idCard,a.target AS target,a.target_name AS targetName,a.contact_phone AS contactPhone,a.detail AS detail,a.collection_location AS collectionLocation,a.collection_feedback AS collectionFeedback,a.content AS content,c.number AS personNumber,f.account_number AS accountNumber,b.hand_number AS handNumber
 FROM (
SELECT
	*
FROM
	case_followup_record
             WHERE case_number IN
            <foreach collection="list" index="index" item="item" open="(" separator="," close=")">
                #{item}
            </foreach>
             AND collection_way != 0
             AND company_code = #{company}
            ) AS a
            LEFT JOIN case_info b ON a.case_number = b.case_number
            LEFT JOIN personal c ON b.personal_id = c.id
            LEFT JOIN product d ON b.product_id = d.id
            LEFT JOIN principal e ON b.principal_id = e.id
            LEFT JOIN personal_bank f ON b.id = f.personal_id
            ORDER BY FIELD(casenum
            <foreach collection="list" index="index" item="item" open="," separator="," close=")">
                #{item}
            </foreach>
    </select>

</mapper>